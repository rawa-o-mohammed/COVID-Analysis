choices = choices,
choices.label.column.to.use = "label")
dap_national<-filter(dap, is.na(repeat.for.variable) & is.na(independent.variable))
dap_national_group<-filter(dap, independent.variable=="ig_8_statut.1")
#dap_national_geo_status<-filter(dap, independent.variable=="geo_status")
dap_admin_2<-filter(dap, repeat.for.variable=="admin_2")
data$wash_17_source_boisson %>% table()
# data<-read.csv("./input/data.csv")
names(data)<-tolower(names(data))
setwd("C:/Users/Yann SAY/Desktop/validation/CAR2003")
# data<-read.csv("./input/data.csv")
data <- read_excel("MSNA_CAR_cleandata_31082020.xlsx", sheet = "CLEAN DATA")
names(data)<-tolower(names(data))
`%!in%` = Negate(`%in%`)
data$wash_17_source_boisson %>% table()
data$wash_17_source_boisson_groupe=ifelse(data$wash_17_source_boisson=="eau_robinet"|
data$wash_17_source_boisson=="fontaine"|
data$wash_17_source_boisson=="forage_mec"|
data$wash_17_source_boisson=="forage_man"|
data$wash_17_source_boisson=="puits_prot"|
data$wash_17_source_boisson=="bouteilles"|
data$wash_17_source_boisson=="eau_camion"|
data$wash_17_source_boisson=="eau_de_pluie"|
data$wash_17_source_boisson=="source_amen", "ameliore", ifelse (data$wash_17_source_boisson=="cours_d_eau", "surface", "non_ameliore"))
table(data$wash_17_source_boisson_groupe, data$wash_17_source_boisson)
data$wash_17_source_boisson_groupe[which(data$wash_17_source_boisson%in% c("nsp", "autre"))]<-NA #modification 3/12/2020
table(data$wash_17_source_boisson_groupe, data$wash_17_source_boisson)
table(data$wash_17_source_boisson_groupe, data$wash_17_source_boisson, useNA = "ifany")
data$wash_2_bin<-ifelse((data$wash_5_lavage_mains_moments.apres_toilette==0 &
data$wash_5_lavage_mains_moments.avant_preparer_aliments==0 &
data$wash_5_lavage_mains_moments.avant_manger==0)|
data$wash_5_lavage_mains_moments.aucun_moment==1, 1, 0 )
library(car)
library(dplyr)
library(openxlsx)
setwd("C:/Users/Yann SAY/Desktop/validation/CAR2003")
#setwd("C:/Users/Stefania Martello/Desktop/msna/input")
list.files()
# data<-read.csv("./input/data.csv")
data <- read_excel("MSNA_CAR_cleandata_31082020.xlsx", sheet = "CLEAN DATA")
names(data)<-tolower(names(data))
`%!in%` = Negate(`%in%`)
data$wash_17_source_boisson_groupe=ifelse(data$wash_17_source_boisson=="eau_robinet"|
data$wash_17_source_boisson=="fontaine"|
data$wash_17_source_boisson=="forage_mec"|
data$wash_17_source_boisson=="forage_man"|
data$wash_17_source_boisson=="puits_prot"|
data$wash_17_source_boisson=="bouteilles"|
data$wash_17_source_boisson=="eau_camion"|
data$wash_17_source_boisson=="eau_de_pluie"|
data$wash_17_source_boisson=="source_amen", "ameliore", ifelse (data$wash_17_source_boisson=="cours_d_eau", "surface", "non_ameliore"))
data$wash_17_source_boisson_groupe[which(data$wash_17_source_boisson%in% c("nsp", "autre"))]<-NA #modification 3/12/2020
################################wash LSG ###############################
data$wash_1_bin<-case_when(data$wash_29_infra_sanit %in% c("latrines_siphon",
"latrines_ventilees_ameliorees",
"fosse_avec_dalle",
"fosse_sans_dalle",
"fosse_surlevee") & data$wash_30_sanit_partagee_combien<=3 ~ 0,
data$wash_29_infra_sanit %in% c("latrines_siphon",
"latrines_ventilees_ameliorees",
"fosse_avec_dalle",
"fosse_sans_dalle",
"fosse_surlevee") & data$wash_30_sanit_partagee=="non" ~ 0,
data$wash_29_infra_sanit %in% c("latrines_siphon",
"latrines_ventilees_ameliorees",
"fosse_avec_dalle",
"fosse_sans_dalle",
"fosse_surlevee") & data$wash_30_sanit_partagee_combien>3 ~ 1)
table(data$wash_1_bind, table$wash_29_infra_sanit, useNA = "ifany")
table(data$wash_1_bind, data$wash_29_infra_sanit, useNA = "ifany")
################################wash LSG ###############################
data$wash_1_bin<-case_when(data$wash_29_infra_sanit %in% c("latrines_siphon",
"latrines_ventilees_ameliorees",
"fosse_avec_dalle",
"fosse_sans_dalle",
"fosse_surlevee") & data$wash_30_sanit_partagee_combien<=3 ~ 0,
data$wash_29_infra_sanit %in% c("latrines_siphon",
"latrines_ventilees_ameliorees",
"fosse_avec_dalle",
"fosse_sans_dalle",
"fosse_surlevee") & data$wash_30_sanit_partagee=="non" ~ 0,
data$wash_29_infra_sanit %in% c("latrines_siphon",
"latrines_ventilees_ameliorees",
"fosse_avec_dalle",
"fosse_sans_dalle",
"fosse_surlevee") & data$wash_30_sanit_partagee_combien>3 ~ 1)
table(data$wash_1_bind, data$wash_29_infra_sanit, useNA = "ifany")
table(data$wash_1_binduseNA = "ifany")
table(data$wash_1_bind,useNA = "ifany")
# data<-read.csv("./input/data.csv")
data <- load_data("msna_factsheet_analysis_08122020.csv")
names(data)<-tolower(names(data))
`%!in%` = Negate(`%in%`)
data$wash_17_source_boisson_groupe=ifelse(data$wash_17_source_boisson=="eau_robinet"|
data$wash_17_source_boisson=="fontaine"|
data$wash_17_source_boisson=="forage_mec"|
data$wash_17_source_boisson=="forage_man"|
data$wash_17_source_boisson=="puits_prot"|
data$wash_17_source_boisson=="bouteilles"|
data$wash_17_source_boisson=="eau_camion"|
data$wash_17_source_boisson=="eau_de_pluie"|
data$wash_17_source_boisson=="source_amen", "ameliore", ifelse (data$wash_17_source_boisson=="cours_d_eau", "surface", "non_ameliore"))
data$wash_17_source_boisson_groupe[which(data$wash_17_source_boisson%in% c("nsp", "autre"))]<-NA #modification 3/12/2020
################################wash LSG ###############################
data$wash_1_bin<-case_when(data$wash_29_infra_sanit %in% c("latrines_siphon",
"latrines_ventilees_ameliorees",
"fosse_avec_dalle",
"fosse_sans_dalle",
"fosse_surlevee") & data$wash_30_sanit_partagee_combien<=3 ~ 0,
data$wash_29_infra_sanit %in% c("latrines_siphon",
"latrines_ventilees_ameliorees",
"fosse_avec_dalle",
"fosse_sans_dalle",
"fosse_surlevee") & data$wash_30_sanit_partagee=="non" ~ 0,
data$wash_29_infra_sanit %in% c("latrines_siphon",
"latrines_ventilees_ameliorees",
"fosse_avec_dalle",
"fosse_sans_dalle",
"fosse_surlevee") & data$wash_30_sanit_partagee_combien>3 ~ 1)
table(data$wash_1_bind, data$wash_29_infra_sanit, useNA = "ifany")
table(data$wash_1_bind, useNA = "ifany")
table(data$wash_29_infra_sanit, useNA = "ifany")
table(data$wash_30_sanit_partagee_combien, useNA = "ifany")
case_when(data$wash_29_infra_sanit %in% c("latrines_siphon",
"latrines_ventilees_ameliorees",
"fosse_avec_dalle",
"fosse_sans_dalle",
"fosse_surlevee") & data$wash_30_sanit_partagee_combien<=3 ~ 0,
data$wash_29_infra_sanit %in% c("latrines_siphon",
"latrines_ventilees_ameliorees",
"fosse_avec_dalle",
"fosse_sans_dalle",
"fosse_surlevee") & data$wash_30_sanit_partagee=="non" ~ 0,
data$wash_29_infra_sanit %in% c("latrines_siphon",
"latrines_ventilees_ameliorees",
"fosse_avec_dalle",
"fosse_sans_dalle",
"fosse_surlevee") & data$wash_30_sanit_partagee_combien>3 ~ 1)
################################wash LSG ###############################
data$wash_1_bin<-case_when(data$wash_29_infra_sanit %in% c("latrines_siphon",
"latrines_ventilees_ameliorees",
"fosse_avec_dalle",
"fosse_sans_dalle",
"fosse_surlevee") & data$wash_30_sanit_partagee_combien<=3 ~ 0,
data$wash_29_infra_sanit %in% c("latrines_siphon",
"latrines_ventilees_ameliorees",
"fosse_avec_dalle",
"fosse_sans_dalle",
"fosse_surlevee") & data$wash_30_sanit_partagee=="non" ~ 0,
data$wash_29_infra_sanit %in% c("latrines_siphon",
"latrines_ventilees_ameliorees",
"fosse_avec_dalle",
"fosse_sans_dalle",
"fosse_surlevee") & data$wash_30_sanit_partagee_combien>3 ~ 1)
################################wash LSG ###############################
data$wash_1_bin
table(data$wash_1_bin, useNA = "ifany")
table(data$wash_1_bin,data$wash_29_infra_sanit, useNA = "ifany")
table(data$wash_1_bin,data$wash_29_infra_sanit,wash_30_sanit_partagee, useNA = "ifany")
table(data$wash_1_bin,data$wash_29_infra_sanit,data$wash_30_sanit_partagee, useNA = "ifany")
data$wash_2_bin<-ifelse((data$wash_5_lavage_mains_moments.apres_toilette==0 &
data$wash_5_lavage_mains_moments.avant_preparer_aliments==0 &
data$wash_5_lavage_mains_moments.avant_manger==0)|
data$wash_5_lavage_mains_moments.aucun_moment==1, 1, 0 )
aa <- ifelse((data$wash_5_lavage_mains_moments.apres_toilette==0 &
data$wash_5_lavage_mains_moments.avant_preparer_aliments==0 &
data$wash_5_lavage_mains_moments.avant_manger==0)|
data$wash_5_lavage_mains_moments.aucun_moment==1, 1, 0 )
data$wash_5_lavage_mains_moments.apres_toilette
data$wash_5_lavage_mains_moments.avant_preparer_aliments
data$wash_5_lavage_mains_moments.avant_manger
data$wash_5_lavage_mains_moments.aucun_moment
car::recode
?recode
data$wash_33_sanit_suffisant %>% table(useNA = "ifany")
(ifelse( data$wash_20_suffisamment_besoins.boire==1 &
data$wash_20_suffisamment_besoins.cuisiner==1 &
data$wash_20_suffisamment_besoins.hygiene_personnelle==1 &
data$wash_20_suffisamment_besoins.autres_besoins==1,0,1)
ifelse( data$wash_20_suffisamment_besoins.boire==1 &
data$wash_20_suffisamment_besoins.cuisiner==1 &
data$wash_20_suffisamment_besoins.hygiene_personnelle==1 &
data$wash_20_suffisamment_besoins.autres_besoins==1,0,1)
car::recode(data$wash_21_problemes_acceder_eau,"'oui'=1;'non'=0;'nsp'=NA") %>% as.numeric
ifelse(data$wash_33_sanit_suffisant %in% c("plus_que_suff", "suff", "juste_assez"), 0, ifelse(data$wash_33_sanit_suffisant %in% c( "insuff", "pas_suff_du_tout" ), 1, NA))
data$lsg_wash_scoring<-
((ifelse( data$wash_20_suffisamment_besoins.boire==1 &
data$wash_20_suffisamment_besoins.cuisiner==1 &
data$wash_20_suffisamment_besoins.hygiene_personnelle==1 &
data$wash_20_suffisamment_besoins.autres_besoins==1,0,1) + # pas de NA
car::recode(data$wash_21_problemes_acceder_eau,"'oui'=1;'non'=0;'nsp'=NA") %>% as.numeric + # 49 nsp
ifelse(data$wash_33_sanit_suffisant %in% c("plus_que_suff", "suff", "juste_assez"), 0, ifelse(data$wash_33_sanit_suffisant %in% c( "insuff", "pas_suff_du_tout" ), 1, NA))+ # pas de NA
ifelse(data$wash_15_lavage_mains_savon %in% c("savon_montre", "savon_pas_montre"), 0, ifelse(data$wash_15_lavage_mains_savon=="non", 1, NA))+ # 255 NA due to data cleaning
data$wash_1_bin +
data$wash_2_bin +
ifelse(data$coping_4_reduction_eau_domestique=="oui"| data$coping_5_utilisation_eau_non_sure=="oui", 1, 0))  /7) %>% # 12 NA
cut(c(0,1/3,2/3,1),c(1,2,3),include.lowest=T) %>%
as.character %>% as.numeric
data$lsg_wash_scoring
data$lsg_wash_scoring %>% table(useNA = "ifany")
data$wash_1_bin %>% table(useNA = "ifany")
data$lsg_wash_tree2=case_when(data$wash_29_infra_sanit %in% c("latrines_siphon",
"latrines_ventilees_ameliorees",
"fosse_avec_dalle",
"fosse_sans_dalle",
"fosse_surlevee")~ 1,
data$wash_29_infra_sanit %in% c("trou_ouvert",
"seau", "sac_plastique", "defec_air_libre_zone_precise",
"defec_air_libre_sans_zone_precise") ~ 3)
table(data$lsg_wash_tree2, data$wash_29_infra_sanit, useNA = "ifany")
table(data$lsg_wash_tree1, data$wash_17_source_boisson_groupe, useNA = "ifany")
pmax
?pmax
table(data$lsg_wash_tree1, useNA = "ifany")
data$sante_vaccin_1
vaccin_rougeole_tot
data$vaccin_rougeole_tot
pivot  <- function(variable) {
variable <- ifelse(variable == "SL", NA, variable)
df %>%
group_by(variable) %>%
summarise(n = n()) %>%
mutate(prop = n/sum(n))
}
pivot  <- function(variable) {
variable <- ifelse(variable == "SL", NA, variable)
data %>%
group_by(variable) %>%
summarise(n = n()) %>%
ungroup() %>%
mutate(prop = n/sum(n))
}
data$wash_17_source_boisson
pivot(variable = data$wash_17_source_boisson)
variable2 <- data$wash_17_source_boisson
variable2
variable2 <- ifelse(data$wash_17_source_boisson == "fontaine", NA, variable)
variable2 <- ifelse(data$wash_17_source_boisson == "fontaine", NA, data$wash_17_source_boisson)
variable2
data %>%
group_by(data$wash_17_source_boisson) %>%
summarise(n = n()) %>%
ungroup() %>%
mutate(prop = n/sum(n))
data %>%
group_by(data$wash_17_source_boisson) %>%
summarise(n = n()) %>%
ungroup() %>%
mutate(prop = n/sum(n)) %>% summarise(sum(prop))
data %>%
group_by(variable2) %>%
summarise(n = n()) %>%
ungroup() %>%
mutate(prop = n/sum(n))
data$wash_17_source_boisson
data %>%
group_by(wash_17_source_boisson) %>%
summarise(n = n()) %>%
ungroup() %>%
mutate(prop = n/sum(n))
wash_17_source_boisson
names(data)
View(data)
data$wash_17_source_boisson
pivot  <- function(variable_name, variable_col) {
data$variable_name <- ifelse(variable_col == "SL", NA, variable_col)
# variable <- ifelse(variable == "SL", NA, variable)
data %>%
group_by(variable) %>%
summarise(n = n()) %>%
ungroup() %>%
mutate(prop = n/sum(n))
}
data %>%
mutate(wash_17_source_boisson = ifelse(wash_17_source_boisson == "fontaine", NA, wash_17_source_boisson)) %>%
group_by(wash_17_source_boisson) %>%
summarise(n = n()) %>%
ungroup() %>%
mutate(prop = n/sum(n))
is.na(data$wash_17_source_boisson)
data %>%
mutate(wash_17_source_boisson = ifelse(wash_17_source_boisson == "fontaine", NA, wash_17_source_boisson)) %>%
filter(!is.na(wash_17_source_boisson)) %>%
group_by(wash_17_source_boisson) %>%
summarise(n = n()) %>%
ungroup() %>%
mutate(prop = n/sum(n))
data %>%
mutate(wash_17_source_boisson = ifelse(wash_17_source_boisson == "fontaine", NA, wash_17_source_boisson)) %>%
# filter(!is.na(wash_17_source_boisson)) %>%
group_by(wash_17_source_boisson) %>%
summarise(n = n()) %>%
ungroup() %>%
mutate(prop = n/sum(n))
data %>%
mutate(wash_17_source_boisson = ifelse(wash_17_source_boisson == "fontaine", NA, wash_17_source_boisson)) %>%
filter(!is.na(wash_17_source_boisson)) %>%
group_by(wash_17_source_boisson) %>%
summarise(n = n()) %>%
ungroup() %>%
mutate(prop = n/sum(n))
?data
data()
variable = data$wash_17_source_boisson
variable <- data$wash_17_source_boisson
variable
variable2 <- ifelse(data$wash_17_source_boisson == "fontaine", NA, data$wash_17_source_boisson)
variable2
data %>%
group_by(wash_17_source_boisson) %>%
summarise(count = n()) %>%
ungroup() %>%
mutate(prop = n/sum(n))
data %>%
group_by(wash_17_source_boisson) %>%
summarise(count = n()) %>%
ungroup() %>%
mutate(prop = count/sum(count))
data$variable2 <- ifelse(data$wash_17_source_boisson == "fontaine", NA, data$wash_17_source_boisson)
data %>%
group_by(variable2) %>%
summarise(count = n()) %>%
ungroup() %>%
mutate(prop = count/sum(count))
data <- load_data("msna_factsheet_analysis_08122020.csv")
variable2 <- ifelse(data$wash_17_source_boisson == "fontaine", NA, data$wash_17_source_boisson)
data %>%
group_by(variable2) %>%
summarise(count = n()) %>%
ungroup() %>%
mutate(prop = count/sum(count))
variable2 %in% names(data)
variable2 %in% names(data) %>% sum()
data$sante_acces  %>% table(useNA = "ifany")
data$sante_1_si_oui  %>% table(useNA = "ifany")
data$sante_5_deces_cause %>% table(useNA = "ifany")
data$sante_5_deces_age %>% table(useNA = "ifany")
data$sante_5_deces %>% table(useNA = "ifany")
data$sante_4_moins5_sympt.diarrhee %>% table(useNA = "ifany")
data$sante_3_moins5_soins %>% table(useNA = "ifany")
data$sante_2_moins5 %>% table(useNA = "ifany")
data$lsg_sante_tree1 %>% table(useNA = "ifany")
################################ protection LSG ###############################
protect9_autre <- read.xlsx("./input/Code_severit?_reponse_autre_v2.xlsx")
################################ protection LSG ###############################
protect9_autre <- read.xlsx("Code_severit?_reponse_autre_v2.xlsx")
################################ protection LSG ###############################
protect9_autre <- read.xlsx("Code_severitÃ©_reponse_autre_v2.xlsx")
################################ protection LSG ###############################
protect9_autre <- read.xlsx("Code_severité_reponse_autre_v2.xlsx")
################################ protection LSG ###############################
protect9_autre <- read_xlsx("Code_severité_reponse_autre_v2.xlsx")
################################ protection LSG ###############################
protect9_autre <- read_xlsx("Code_severitÃ©_reponse_autre_v2.xlsx")
list.files()
list.files()
list.files()
################################ protection LSG ###############################
protect9_autre <- read_xlsx("Code__reponse_autre_v2.xlsx")
match(data$protect_2_femmes_risque_autre, protect9_autre$GARCON)
match
?match
protect9_autre$GARCON
protect9_autre$Severite[match(data$protect_2_femmes_risque_autre, protect9_autre$GARCON)]
data$protect_2_femmes_risque_autre_sev <- protect9_autre$Severite[match(data$protect_2_femmes_risque_autre, protect9_autre$GARCON)]
data$protect_2_hommes_risque_autre_sev <- protect9_autre$Severite[match(data$protect_2_hommes_risque_autre, protect9_autre$GARCON)]
data$protect_3_garcons_risque_autre_sev <- protect9_autre$Severite[match(data$protect_3_garcons_risque_autre, protect9_autre$GARCON)]
data$protect_3_filles_risque_autre_sev <- protect9_autre$Severite[match(data$protect_3_filles_risque_autre, protect9_autre$GARCON)]
data$protect_3_garcons_risque_autre
data$protect_3_garcons_risque
data$protect_3_garcons
data$protect_2_femmes_risque.violence_sexuelles
data$protect_2_femmes_risque.recrutement_force
data$protect_2_hommes_risque.recrutement_force
grep("protect_3_garcons_risque", names(data), value = T)
grep("protect_2_hommes_risque.separation_famille", names(data), value = T)
protect_2_hommes_risque.separation_famille %>% table(useNA = "ifany")
data$protect_2_hommes_risque.separation_famille %>% table(useNA = "ifany")
data$lsg_protection_tree_4= case_when(
data$protect_3_garcons_risque_autre_sev == 5 ~ 3,
data$protect_3_filles_risque_autre_sev == 5 ~ 3,
data$protect_2_femmes_risque_autre_sev == 5 ~ 3,
data$protect_2_hommes_risque_autre_sev == 5 ~ 3,
data$protect_3_garcons =="oui" & (
data$protect_3_garcons_risque.violence_sexuelles==1| data$protect_3_garcons_risque.recrutement_force==1) ~ 3,
data$protect_3_filles=="oui" & (
data$protect_3_filles_risque.violence_sexuelles==1| data$protect_3_filles_risque.recrutement_force==1)~ 3,
data$protect_2_femmes=="oui" & (
data$protect_2_femmes_risque.violence_sexuelles==1| data$protect_2_femmes_risque.recrutement_force==1)~ 3,
data$protect_2_hommes=="oui" & (
data$protect_2_hommes_risque.violence_sexuelles==1| data$protect_2_hommes_risque.recrutement_force==1)~ 3,
data$protect_3_garcons_risque_autre_sev == 4 ~ 3 ,
data$protect_3_filles_risque_autre_sev == 4 ~ 3 ,
data$protect_2_femmes_risque_autre_sev == 4 ~ 3 ,
data$protect_2_hommes_risque_autre_sev == 4 ~ 3 ,
data$protect_3_garcons =="oui" & ( data$protect_3_garcons_risque.meurtre_diff_groupes==1| data$protect_3_garcons_risque.meurtre_meme_groupe==1|
data$protect_3_garcons_risque.mariage_force ==1| data$protect_3_garcons_risque.enlevement==1|
data$protect_3_garcons_risque.enlevement_travail_force==1|
data$protect_3_garcons_risque.travail_force==1 | data$protect_3_garcons_risque.separation_famille==1|
data$protect_3_garcons_risque.incident_transhumance==1) ~ 3,
data$protect_3_filles=="oui" & ( data$protect_3_filles_risque.meurtre_diff_groupes==1| data$protect_3_filles_risque.meurtre_meme_groupe==1|
data$protect_3_filles_risque.mariage_force==1| data$protect_3_filles_risque.enlevement==1|
data$protect_3_filles_risque.enlevement_travail_force==1|
data$protect_3_filles_risque.travail_force==1 | data$protect_3_filles_risque.separation_famille==1|
data$protect_3_filles_risque.incident_transhumance==1 )~ 3,
data$protect_2_femmes=="oui" & (data$protect_2_femmes_risque.meurtre_diff_groupes==1| data$protect_2_femmes_risque.meurtre_meme_groupe==1|
data$protect_2_femmes_risque.mariage_force==1| data$protect_2_femmes_risque.enlevement==1|
data$protect_2_femmes_risque.enlevement_travail_force==1|
data$protect_2_femmes_risque.travail_force==1 | data$protect_2_femmes_risque.incident_transhumance==1|
data$protect_2_femmes_risque.separation_famille==1 )~ 3,
data$protect_2_hommes=="oui" & ( data$protect_2_hommes_risque.meurtre_diff_groupes==1| data$protect_2_hommes_risque.meurtre_meme_groupe==1|
data$protect_2_hommes_risque.mariage_force==1| data$protect_2_hommes_risque.enlevement==1|
data$protect_2_hommes_risque.enlevement_travail_force==1|
data$protect_2_hommes_risque.travail_force==1 | data$protect_2_hommes_risque.incident_transhumance==1|
data$protect_2_hommes_risque.separation_famille==1 )~ 3,
data$protect_3_garcons_risque_autre_sev == 3 ~ 3,
data$protect_3_filles_risque_autre_sev == 3 ~ 3,
data$protect_2_femmes_risque_autre_sev == 3 ~ 3,
data$protect_2_hommes_risque_autre_sev == 3 ~ 3,
data$protect_3_garcons_risque_autre_sev == 2 ~ 2,
data$protect_3_filles_risque_autre_sev == 2 ~ 2,
data$protect_2_femmes_risque_autre_sev == 2 ~ 2,
data$protect_2_hommes_risque_autre_sev == 2 ~ 2,
data$protect_3_garcons =="oui" & ( data$protect_3_garcons_risque.harcelement==1|
data$protect_3_garcons_risque.tensions_communautes==1|
data$protect_3_garcons_risque.pillage_criminalite==1|
data$protect_3_garcons_risque.vol_betail==1|
data$protect_3_garcons_risque.violence_voisins|
data$protect_3_garcons_risque.conflits_fonciers==1) ~ 2,
data$protect_3_filles=="oui" & ( data$protect_3_filles_risque.harcelement==1|
data$protect_3_filles_risque.vol_betail==1|
data$protect_3_filles_risque.tensions_communautes==1|
data$protect_3_filles_risque.pillage_criminalite==1|
data$protect_3_filles_risque.violence_voisins==1|
data$protect_3_filles_risque.conflits_fonciers==1
)~ 2,
data$protect_2_femmes=="oui" & ( data$protect_2_femmes_risque.harcelement==1|
data$protect_2_femmes_risque.tensions_communautes==1|
data$protect_2_femmes_risque.pillage_criminalite==1|
data$protect_2_femmes_risque.vol_betail==1|
data$protect_2_femmes_risque.violence_voisins==1|
data$protect_2_femmes_risque.conflits_fonciers==1)~ 2,
data$protect_2_hommes=="oui" & ( data$protect_2_hommes_risque.harcelement==1|
data$protect_2_hommes_risque.vol_betail==1|
data$protect_2_hommes_risque.pillage_criminalite==1|
data$protect_2_hommes_risque.violence_voisins==1|
data$protect_2_hommes_risque.conflits_fonciers==1|
data$protect_2_hommes_risque.tensions_communautes==1)~ 2,
data$protect_3_garcons  %in% c("non") |  data$protect_3_filles %in% c("non")|  data$protect_2_femmes %in% c("non")| data$protect_2_hommes %in% c("non") ~ 1
)
data$lsg_protection_tree_4 %>% table(useNA = "ifany")
data$protect_3_garcons_risque.violence_sexuelles %>% table(useNA = "ifany")
protect_14_numerator<-select(data, protect_14_1, protect_14_2, protect_14_3, protect_14_4)
protect_14_denumerator<-select(data, tot_filles_17moins,tot_gar_17moins, tot_femmes_18plus, tot_hommes_18plus)
data$protect_14.num<-rowSums(protect_14_numerator, na.rm = T)
data$protect_14.den<-rowSums(protect_14_denumerator, na.rm = T)
data$protect_14.prop<- data$protect_14.num/data$protect_14.den
data$protect_14.prop
data$protect_14 %>% table(useNA = "ifany")
data$protect_14.prop
data$protect_14_propriete
data$protect_1_2
data$mssc_1_3_trav_enf %>% table(useNA = "ifany")
setwd("C:/Users/Yann SAY/Desktop/validation/COVID-Analysis")
# setup
setwd("C:/Users/Yann SAY/Desktop/validation/COVID-Analysis")
data$protect_13  %>% table(useNA = "ifany")
data$lsg_protection_scoring_1<-
(data$prot_1_bin +    # 277 nsp
# data$prot_2_bin + # no NAs
ifelse(data$protect_1_2=="oui",1, ifelse(data$protect_1_2 %in% c("nsp", NA), NA, 0))+ # 178 "nsp"
ifelse(data$protect_12_1=="oui" & data$protect_12_1_2=="oui" &
data$protect_12_2=="oui" & data$protect_12_2_2=="oui" &
data$protect_12_3=="oui" & data$protect_12_3_2=="oui" &
data$protect_12_4=="oui" & data$protect_12_4_2=="oui", 0, 1) + # 77 NAs
ifelse(data$protect_13 %in% c("aucun", "nsp"), 1, 0)+ # 309 "nsp"
data$prot_3_bin  +  #
data$prot_4_bin)/6   #no NAs
lsg_protection_scoring_1 %>% table()
data$lsg_protection_scoring_1 %>% table()
data$lsg_protection_scoring<- data$lsg_protection_scoring_1  %>%
cut(c(0,1/3,2/3,1),c(1,2,3),include.lowest = T) %>% as.character %>% as.numeric
data$lsg_protection_scoring %>% table()
data$lsg_protection<-ifelse(data$lsg_protection_tree1==5|data$lsg_protection_tree2==5| data$lsg_protection_tree3==5| data$lsg_protection_tree_4==5, 5,
ifelse(is.na(data$lsg_protection_scoring) & (data$lsg_protection_tree1>=3|data$lsg_protection_tree2>=3|data$lsg_protection_tree3>=3|data$lsg_protection_tree_4>=3),
pmax(data$lsg_protection_tree1, data$lsg_protection_tree2, data$lsg_protection_tree3, data$lsg_protection_tree_4, na.rm = F),
ifelse(is.na(data$lsg_protection_tree_4) & (data$lsg_protection_tree1>=3|data$lsg_protection_tree2>=3|data$lsg_protection_tree3>=3),
pmax(data$lsg_protection_tree1, data$lsg_protection_tree2, data$lsg_protection_tree3, na.rm = F),
pmax(data$lsg_protection_scoring,data$lsg_protection_tree1, data$lsg_protection_tree2, data$lsg_protection_tree3, data$lsg_protection_tree_4, na.rm = F))))
data$lsg_protection %>% table()
aa <- c("lsg_protection_tree1", "lsg_protection_tree2", "lsg_protection_tree3", "lsg_protection_tree4")
lapply(aa, function(x) data$x %>% table() %>% prop.table)
data$lsg_protection_tree1 %>% table() %>% prop.table
data$lsg_protection_tree2 %>% table() %>% prop.table
data$mssc_2_2 %>% table()
data$mssc_2_2.aucun
(data$secal_9_acces_marche %in% c(NA)
)
(data$secal_9_acces_marche)
data$lsg_secal_scoring<-
((  ifelse(data$mssc_1_revenu%in%c("none","1_10000","10001_30000"),1,ifelse(data$mssc_1_revenu=="nsp",NA, 0))+ #491 nsp!!!
data$secal_bin_1  + # 392 NAs (cleaning for inconsistency)
#   ifelse(data$fcs_cat=="acceptable",0, ifelse(is.na(data$fcs_cat), NA, 1))+ #27 NAs (cleaning of FCS)
#   ifelse(data$rcsi_cat %in% c("moyen", "eleve"), 1, 0) +
ifelse(data$secal_6_agric=="oui", 1, ifelse(data$secal_6_agric=="nsp", NA, 0))+ # 78 nsp
ifelse(data$secal_9_acces_marche=="marche_accessible", 0, ifelse(data$secal_9_acces_marche %in% c(NA, "nsp"), NA ,1))+ # 594 NAs (cleaning of inconsistency)
ifelse(data$mssc_3_depense_agr_in_totale>=0.5, 1, ifelse(is.na(data$mssc_3_depense_agr_in_totale), NA, 0))+ # 378 NAs #feedback of secal cluster
ifelse(data$mssc_2_source_rev_1%in% c( "transferts_argent", "dons_hum")|
data$mssc_2_source_rev_2%in% c( "transferts_argent", "dons_hum")|
data$mssc_2_source_rev_3%in% c( "transferts_argent", "dons_hum"), 1, 0))/6) %>% # no NAs
cut(c(0,1/3,2/3,1),c(1,2,3),include.lowest = T) %>% as.character() %>% as.numeric()
table((data$sante_5_deces_cause %in% c("maladie_diarr", "manque_nourrit")),(data$sante_5_deces_age <5) )
